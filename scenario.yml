# Scenario for action workflow like a behavioral test

init:
  actions:
    - updateContext:
        login: api
        password: api
        baseUrl: http://localhost:3005
        persistentHeaders:
          user-agent: test/0.4
requestHook:
  status: 401
  replay: true
    # criteria: $current.result.errorCode === 'TokenNeedsRefresh'
  action:
    request:
      endpoint: /api/authentication/refresh
      method: POST
      body:
        login: §context.login
        password: §context.password

steps:
  login: # this is the step name
    label: first login
    actions:
      - request:
          endpoint: /api/authentication/login
          method: POST
          body:
            login: §context.login
            password: §context.password
          expect:
            status: 200
      - updateContext:
          persistentHeaders:
            authorization: Bearer §previous.result.body.token
            deviceId: §previous.result.body.deviceId
  deep-health:
    label: Deep health
    actions:
      - request:
          endpoint: /health
          method: GET

  home-hotel:
    label: Home page
    actions:
      - request:
          endpoint: /api/home/hotel
          method: GET
          expect:
            status: 200
            headers:
              x-paging-pages-total: 0
              x-paging-pages-current: 0
            body: |
              []
